# How tref Works

`tref` is a command-line tool that helps you manage and search your cheatsheets. It uses semantic search and AI embeddings to provide you with the most relevant commands for your query.

## Architecture

The architecture of `tref` is simple and modular. It consists of the following components:

*   **`cli.py`**: This is the entry point of the application. It uses `argparse` to parse the command-line arguments and then calls the appropriate functions from the other modules.
*   **`cheatsheet.py`**: This module contains the `CheatSheetManager` class, which is responsible for managing the cheatsheets. It provides methods for listing, reading, editing, adding, and deleting cheatsheets.
*   **`embeddings.py`**: This module contains the `EmbeddingManager` class, which is responsible for generating the embeddings for the cheatsheets. It uses the `transformers` library to generate the embeddings.
*   **`search.py`**: This module contains the `SearchManager` class, which is responsible for performing the semantic search. It uses the embeddings generated by the `EmbeddingManager` to find the most relevant commands.
*   **`config.py`**: This module provides a function to get the configuration directory for the application.

## How it works

1.  **Cheatsheet Management**: When you add a new cheatsheet, the `CheatSheetManager` creates a new JSON file in the user's config directory (`~/.config/tref/cheatsheets`). The cheatsheet is stored in a structured format that includes the command, an explanation, and tags.

2.  **Embedding Generation**: When you run the `tref --update-embeddings` command, the `EmbeddingManager` reads all the cheatsheets and generates embeddings for each command. The embeddings are then stored in a `vectors.npy` file in the config directory. A `meta.jsonl` file is also created to store the metadata for each embedding.

3.  **Semantic Search**: When you run the `tref --search` command, the `SearchManager` loads the embeddings and metadata. It then generates an embedding for your query and uses cosine similarity to find the most similar commands in the cheatsheets. The top results are then displayed to you.

4.  **Default Cheatsheets**: When you run `tref` for the first time, it automatically copies the default cheatsheets to your config directory. The default cheatsheets are bundled with the application using `setuptools` and `importlib.resources`.
